local br = _G["br"]
if br.api == nil then br.api = {} end
br.api.runeforge = function(runeforge,k,v)
    runeforge[k].equiped = false

    local itemLeggoSlots = {
        [1] = 1, -- Head
        [2] = 2, -- Neck
        [3] = 3, -- Shoulder
        [4] = 5, -- Chest
        [5] = 6, -- Waist
        [6] = 7, -- Legs
        [7] = 8, -- Feet
        [8] = 9, -- Wrists
        [9] = 10, -- Hands
        [10] = 11, -- Finger1
        [11] = 12, -- Finger2
        [12] = 15, -- Back
    }

    -- Legendaries based on https://wow.tools/dbc/?dbc=runeforgelegendaryability
    -- mapping bonus id to legendary power id
    local bonusToPowerId = {
        [6823] = 2,
        [6828] = 3,
        [6829] = 4,
        [6830] = 5,
        [6831] = 6,
        [6832] = 7,
        [6937] = 8,
        [6834] = 9,
        [6931] = 10,
        [6932] = 11,
        [6933] = 12,
        [6934] = 13,
        [6926] = 14,
        [6927] = 15,
        [6928] = 16,
        [6936] = 17,
        [7041] = 18,
        [7042] = 19,
        [7043] = 20,
        [7044] = 21,
        [7049] = 22,
        [7050] = 23,
        [7051] = 24,
        [7052] = 25,
        [7045] = 26,
        [7046] = 27,
        [7047] = 28,
        [7048] = 29,
        [6953] = 30,
        [6954] = 31,
        [6947] = 32,
        [6948] = 33,
        [6940] = 34,
        [6941] = 35,
        [6943] = 36,
        [6942] = 37,
        [6944] = 38,
        [6945] = 39,
        [6946] = 40,
        [7160] = 41,
        [6949] = 42,
        [6950] = 43,
        [6951] = 44,
        [6952] = 45,
        [7086] = 46,
        [7085] = 47,
        [7110] = 48,
        [7084] = 49,
        [7087] = 50,
        [7088] = 51,
        [7107] = 52,
        [7108] = 53,
        [7109] = 54,
        [7091] = 55,
        [7090] = 56,
        [7089] = 57,
        [7092] = 58,
        [7093] = 59,
        [7094] = 60,
        [7095] = 61,
        [7096] = 62,
        [7097] = 63,
        [7098] = 64,
        [7099] = 65,
        [7003] = 66,
        [7004] = 67,
        [7005] = 68,
        [7006] = 69,
        [7007] = 70,
        [7008] = 71,
        [7009] = 72,
        [7010] = 73,
        [7011] = 74,
        [7012] = 75,
        [7013] = 76,
        [7014] = 77,
        [7015] = 78,
        [7016] = 79,
        [7017] = 80,
        [7018] = 81,
        [7184] = 82,
        [7082] = 83,
        [7080] = 84,
        [7081] = 85,
        [7076] = 86,
        [7077] = 87,
        [7078] = 88,
        [7079] = 89,
        [7075] = 90,
        [7073] = 91,
        [7074] = 92,
        [7072] = 93,
        [7070] = 94,
        [7068] = 95,
        [7071] = 96,
        [7069] = 97,
        [7053] = 98,
        [7055] = 100,
        [7056] = 101,
        [7128] = 102,
        [7059] = 103,
        [7057] = 104,
        [7058] = 105,
        [7060] = 106,
        [7061] = 107,
        [7062] = 108,
        [7063] = 109,
        [7067] = 110,
        [7066] = 111,
        [7065] = 112,
        [7064] = 113,
        [7114] = 114,
        [7113] = 115,
        [7112] = 116,
        [7111] = 117,
        [7115] = 118,
        [7116] = 119,
        [7117] = 120,
        [7118] = 121,
        [7122] = 122,
        [7121] = 123,
        [7120] = 124,
        [7119] = 125,
        [7123] = 126,
        [7124] = 127,
        [7125] = 128,
        [7126] = 129,
        [6985] = 130,
        [6986] = 131,
        [6987] = 132,
        [6988] = 133,
        [6989] = 134,
        [6990] = 135,
        [6991] = 136,
        [6992] = 137,
        [6993] = 138,
        [6994] = 139,
        [6995] = 140,
        [6996] = 141,
        [6997] = 142,
        [6998] = 143,
        [6999] = 144,
        [7000] = 145,
        [7161] = 146,
        [7002] = 147,
        [6975] = 148,
        [6972] = 149,
        [6976] = 150,
        [6978] = 151,
        [6979] = 152,
        [6980] = 153,
        [6984] = 154,
        [6977] = 155,
        [6974] = 156,
        [6973] = 157,
        [6981] = 158,
        [6982] = 159,
        [6983] = 160,
        [7162] = 161,
        [7025] = 162,
        [7026] = 163,
        [7027] = 164,
        [7028] = 165,
        [7029] = 166,
        [7030] = 167,
        [7031] = 168,
        [7032] = 169,
        [7033] = 170,
        [7034] = 171,
        [7035] = 172,
        [7036] = 173,
        [7037] = 174,
        [7038] = 175,
        [7039] = 176,
        [7040] = 177,
        [6955] = 178,
        [6971] = 179,
        [6958] = 180,
        [6959] = 181,
        [6962] = 182,
        [6960] = 183,
        [6961] = 184,
        [6970] = 185,
        [6963] = 186,
        [6964] = 187,
        [6965] = 188,
        [6966] = 189,
        [6956] = 190,
        [6957] = 191,
        [6967] = 192,
        [6969] = 193,
        [7054] = 196,
        [7100] = 199,
        [7101] = 200,
        [7102] = 201,
        [7103] = 202,
        [7104] = 203,
        [7105] = 204,
        [7106] = 205,
        [7159] = 206,
    }

    for i = 1, #itemLeggoSlots do
        local thisSlot = itemLeggoSlots[i]
        if GetInventoryItemID("player",thisSlot) ~= nil then
            -- From: https://wow.gamepedia.com/ItemLocationMixin
            local item = ItemLocation:CreateFromEquipmentSlot(thisSlot)
            if item:IsValid() then
                if C_LegendaryCrafting.IsRuneforgeLegendary(item) then
                    local bonusID = select(15,strsplit(":", GetInventoryItemLink("player",thisSlot)))
                    -- Print("Item in Slot: "..thisSlot.." returned bonusID: "..bonusID)
                    local powerID = bonusToPowerId[tonumber(bonusID)]
                    if powerID ~= nil then
                        local powerInfo = C_LegendaryCrafting.GetRuneforgePowerInfo(powerID)
                        if powerInfo.descriptionSpellID == v then
                            -- Print("Legendary Item Effect: "..tostring(powerInfo.name).." found on item: "..tostring(C_Item.GetItemName(item)))
                            runeforge[k].equiped = true
                            break
                        end
                    end
                end
            end
        end
    end
end